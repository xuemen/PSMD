# Skill: 12119600 - Branch Version Management

**Version**: 1.0.0
**Skill ID**: 12119600
**Category**: Version Control
**Last Updated**: 2025-01-10

---

## 1. Description

This skill defines the framework for managing different approaches to the same regulatory matters as branch versions. Any treatment of a matter without specific provisions is considered a branch version itself. The skill establishes rules for adopting branch versions, handling revision requests, and preventing selective citation that misrepresents regulatory dependencies.

## 2. Input Data Structure

```yaml
$schema: https://agentskills.io/schemas/branch_version_management
type: object
properties:
  branch_id:
    type: string
    pattern: ^[a-f0-9]{8}$
    description: Unique identifier for this branch management record
  matter_context:
    type: object
    properties:
      matter_id:
        type: string
        description: Identifier of the matter being addressed
        required: true
      matter_description:
        type: string
        description: Description of the matter
        required: true
    required:
      - matter_id
      - matter_description
  branch_versions:
    type: array
    items:
      type: object
      properties:
        branch_id:
          type: string
          description: Unique identifier for this branch
          required: true
        branch_name:
          type: string
          description: Name or description of this branch
          required: true
        treatment_type:
          type: string
          enum: [specific_provision, no_provision, partial_provision]
          description: How this branch treats the matter
          required: true
        adopted_by:
          type: array
          items:
            type: string
          description: Entities that have adopted this branch
        status:
          type: string
          enum: [active, deprecated, abandoned, proposed]
          description: Current status of this branch
        effective_date:
          type: string
          format: date
          description: Date this branch became effective
        provisions:
          type: array
          items:
            type: string
          description: Specific provisions in this branch
    required:
      - branch_id
      - branch_name
      - treatment_type
      - adopted_by
  adoption_record:
    type: object
    properties:
      adopting_entity:
        type: string
        description: Entity making the adoption
        required: true
      adopted_branch_id:
        type: string
        description: Branch being adopted
        required: true
      adoption_date:
        type: string
        format: date
        description: Date of adoption
      rejection_of_other_branches:
        type: boolean
        description: Whether adoption implies rejection of other branches
        required: true
      rejected_branch_ids:
        type: array
        items:
          type: string
        description: Branches rejected by this adoption
  revision_request:
    type: object
    properties:
      request_id:
        type: string
        description: Unique request identifier
      requesting_party:
        type: string
        description: Party requesting the revision
        required: true
      target_branch_id:
        type: string
        description: Branch to be revised
        required: true
      request_type:
        type: string
        enum: [revision, help_switch, clarification]
        description: Type of request
        required: true
      direction_to_opponent:
        type: boolean
        description: Whether request is directed to opponent branch
        required: true
      compensation_info:
        type: object
        properties:
          is_paid_request:
            type: boolean
            description: Whether this is a compensated request
            required: true
          payment_amount:
            type: number
            description: Payment amount if applicable
          payment_currency:
            type: string
            description: Currency of payment
          recipient_response_requirement:
            type: string
            enum: [full_response, actual_received_only, n/a]
            description: Response requirement for recipient
    required:
      - requesting_party
      - target_branch_id
      - request_type
      - direction_to_opponent
  query_context:
    type: object
    properties:
      querying_party:
        type: string
        description: Party making the query
        required: true
      query_type:
        type: string
        enum: [no_provision_branch, other_branch]
        description: Type of branch being queried
        required: true
      branch_id_being_queried:
        type: string
        description: ID of branch being queried
      scope_of_response:
        type: string
        enum: [all_branches, this_branch_only]
        description: Scope of information to provide
    required:
      - querying_party
      - query_type
  created_at:
    type: string
    format: date-time
    description: Timestamp of creation
    required: true
```

## 3. Output Data Structure

```yaml
$schema: https://agentskills.io/schemas/branch_version_validation_result
type: object
properties:
  decision:
    type: string
    enum: [COMPLIANT, IGNORE, CLARIFY]
    description: Compliance decision
  branch_id:
    type: string
    pattern: ^[a-f0-9]{8}$
    description: Reference to branch management record
  all_branches_recognized:
    type: boolean
    description: Whether all branch versions are properly acknowledged
  adoption_implies_rejection:
    type: boolean
    description: Whether branch adoption correctly implies rejection
  request_handling_correct:
    type: boolean
    description: Whether requests are properly routed and handled
  query_response_scope_correct:
    type: boolean
    description: Whether query responses follow branch-specific rules
  findings:
    type: array
    items:
      type: object
      properties:
        severity:
          type: string
          enum: [error, warning, info]
        issue:
          type: string
          description: Identified issue
        recommendation:
          type: string
          description: Recommended action
  metadata:
    type: object
    properties:
      validated_by:
        type: string
        description: Agent ID that performed validation
      validated_at:
        type: string
        format: date-time
        description: Timestamp of validation
      applied_norms:
        type: array
        items:
          type: string
        description: List of skill IDs and versions applied
```

## 4. Error Patterns (Auto-Detection)

### 4.1 Missing Branch Recognition Pattern
```
Pattern: Treating a matter as adopted without recognizing branch versions
Detection Rule:
  - Check that 'branch_versions' array is complete
  - Verify 'no_provision' is recognized as a valid branch
  - Flag if only one branch is considered
Natural Language Detection:
  "All approaches to this matter, including no specific provision, must be
   recognized as valid branch versions. Please enumerate all branches that
   exist for this matter."
Response: CLARIFY
```

### 4.2 Adoption Without Rejection Pattern
```
Pattern: Adopting one branch without acknowledging rejection of others
Detection Rule:
  - Check 'adoption_record.rejection_of_other_branches' is true
  - Verify 'rejected_branch_ids' is populated
  - Flag selective adoption claims
Natural Language Detection:
  "Adopting a branch version implies rejection of other branches. Please
   explicitly acknowledge which branches are rejected by this adoption."
Response: CLARIFY
```

### 4.3 Opponent Direction Misrouting Pattern
```
Pattern: Revision request sent to opponent branch without conversion
Detection Rule:
  - Check 'revision_request.direction_to_opponent'
  - If true, verify 'request_type' is 'help_switch'
  - Flag requests to opponents that aren't conversion requests
Natural Language Detection:
  "Requests directed to opponent branches are automatically converted to
   switch-branch requests. Please confirm you want to switch to their branch
   or redirect to your own branch."
Response: CLARIFY
```

### 4.4 Scope Violation in Query Pattern
```
Pattern: Query to non-no_provision branch providing all branches' information
Detection Rule:
  - Check 'query_context.query_type' and 'scope_of_response'
  - For 'other_branch' queries, verify 'this_branch_only' scope
  - Flag information over-sharing
Natural Language Detection:
  "When querying a specific branch (not the no-provision branch), only
   provide that branch's information, not details from other branches."
Response: CLARIFY
```

### 4.5 Paid Request Scope Violation Pattern
```
Pattern: Paid request to opponent branch answered beyond actual received
Detection Rule:
  - Check 'compensation_info.is_paid_request' and 'direction_to_opponent'
  - If both true, verify 'recipient_response_requirement' is 'actual_received_only'
  - Flag over-servicing of paid opponent requests
Natural Language Detection:
  "For compensated requests to opponent branches, you only need to address
   what was actually received, not the original question. Please scope your
   response appropriately."
Response: CLARIFY
```

## 5. Prompt Templates

### 5.1 Branch Enumeration Template
```
Enumerating branches for matter: {matter_description}

A matter can be addressed through multiple approaches. Each approach
constitutes a branch version, including the approach of making no specific
provision.

Branch Categories:
1. Specific Provision Branches: Document each distinct treatment approach
2. No Provision Branch: The absence of specific provisions is itself a branch

For each branch, provide:
- Branch identifier and name
- Treatment type (specific/no/partial provision)
- Entities that have adopted this branch
- Current status (active/deprecated/proposed)
- Specific provisions if applicable

Which branches exist for this matter?
```

### 5.2 Adoption Declaration Template
```
Declaring adoption of branch: {branch_id}

By adopting this branch, you are:
[ ] Accepting the provisions of this branch
[ ] Rejecting all other branches for this matter
[ ] Acknowledging that inquiries to opponents become switch requests
[ ] Accepting that switch requests to opponents may be compensated

Rejected Branches:
{list_of_rejected_branches}

Is this declaration correct?
```

## 6. JSON Example

```json
{
  "branch_id": "12119600-001",
  "matter_context": {
    "matter_id": "matter-001",
    "matter_description": "Employee Data Privacy Standards"
  },
  "branch_versions": [
    {
      "branch_id": "branch-a",
      "branch_name": "Full GDPR Compliance",
      "treatment_type": "specific_provision",
      "adopted_by": ["organization-001", "organization-002"],
      "status": "active",
      "effective_date": "2024-01-01",
      "provisions": ["Article 6 compliance", "Data minimization", "Consent documentation"]
    },
    {
      "branch_id": "branch-b",
      "branch_name": "Basic Compliance",
      "treatment_type": "partial_provision",
      "adopted_by": ["organization-003"],
      "status": "active",
      "effective_date": "2024-06-01",
      "provisions": ["Minimum consent requirements"]
    },
    {
      "branch_id": "branch-none",
      "branch_name": "No Specific Provision",
      "treatment_type": "no_provision",
      "adopted_by": [],
      "status": "active"
    }
  ],
  "adoption_record": {
    "adopting_entity": "organization-001",
    "adopted_branch_id": "branch-a",
    "adoption_date": "2024-01-01",
    "rejection_of_other_branches": true,
    "rejected_branch_ids": ["branch-b", "branch-none"]
  },
  "revision_request": {
    "requesting_party": "organization-003",
    "target_branch_id": "branch-a",
    "request_type": "help_switch",
    "direction_to_opponent": true,
    "compensation_info": {
      "is_paid_request": false,
      "recipient_response_requirement": "n/a"
    }
  },
  "query_context": {
    "querying_party": "organization-002",
    "query_type": "other_branch",
    "branch_id_being_queried": "branch-a",
    "scope_of_response": "this_branch_only"
  },
  "created_at": "2025-01-10T11:00:00Z"
}
```

## 7. Validation Rules

| Field | Rule | Error Message |
|-------|------|---------------|
| matter_id | Must not be empty | "Matter identifier is required" |
| matter_description | Must not be empty | "Matter description is required" |
| branch_versions | Required, minimum 1 | "At least one branch must be defined" |
| rejection_of_other_branches | Must be true for adoption | "Adoption must imply rejection of other branches" |
| direction_to_opponent | Must match request_type | "Opponent direction requires help_switch type" |
| recipient_response_requirement | Required for paid requests | "Response requirement must be specified" |
| scope_of_response | Must be 'this_branch_only' for other_branch queries | "Other branch queries limited to that branch" |

## 8. Dependencies and Relationships

### 8.1 Depends On
- **6d206b54**: Hierarchical Authority Relations - Related to branch authority
- **d0111eb4**: Expected Effect Justification - Branch-specific effects

### 8.2 Related Skills
- **600f6f80**: Regulatory Justification Requirements - Cross-branch evidence handling
- **5ab2b2ba**: Leadership Transition Protocol - Branch adoption in leadership changes

## 9. Error Handling Behaviors

| Error Type | Handling Behavior |
|------------|-------------------|
| Incomplete branch enumeration | REFUSE, require full enumeration |
| Adoption without rejection | REFUSE, require rejection specification |
| Misrouted opponent request | REFUSE, require conversion to switch request |
| Scope violation in query | REFUSE, enforce branch-specific scoping |
| Over-servicing paid request | WARN and enforce response limitations |

## 10. Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-01-10 | Initial release |

---

**End of Skill 12119600**
